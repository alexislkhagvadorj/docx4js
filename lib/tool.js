'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

var isNode = false;
try {
  isNode = Object.prototype.toString.call(global.process) === '[object process]';
} catch (e) {}

function makeTool(xmlParser, Document, Node, NodeList, scopable) {
  var $tool = {
    isNode: isNode,
    parseXML: xmlParser,
    extend: Object.assign,
    isFunction: function isFunction(a) {
      return typeof a === 'function';
    },
    isArray: function isArray(a) {
      return Array.isArray(a);
    },
    each: function each(a, f, ctx) {
      if (Array.isArray(a)) {
        a.forEach(f, ctx);
      } else if ((typeof a === 'undefined' ? 'undefined' : _typeof(a)) === 'object') {
        Object.keys(a).forEach(function (k) {
          f.call(ctx, k, a[k]);
        });
      }
    },
    map: function map(a, f, ctx) {
      return a.map(f, ctx);
    }
  };

  $tool.extend($tool, {
    toArray: function toArray(args) {
      var a = [];
      for (var i = 0, len = args.length; i < len; i++) {
        a.push(args[i]);
      }return a;
    }
  });

  var directChildSelector = /((^|,)\s*>)/,
      id = 'sxxx';
  $tool.extend(Node.prototype, {
    $: function $(selector) {
      if (!directChildSelector.test(selector)) return this.querySelectorAll(selector);else if (scopable) return this.querySelectorAll(selector.split(',').map(function (a) {
        return a.trim().charAt(0) == '>' ? ':scope' + a : a;
      }).join(','));else if (this.id) {
        return this.querySelectorAll(selector.split(',').map(function (a) {
          //return  '#'+this.id+((a=a.trim()).charAt(0)=='>' ? '' : ' ')+a
          return (a = a.trim()).charAt(0) == '>' ? a.substring(1) : a;
        }, this).join(','));
      } else {
        this.id = id;
        var nodes = this.querySelectorAll(selector.split(',').map(function (a) {
          //IE can't find '#xx', @todo: fix it later
          //return  '#'+this.id+((a=a.trim()).charAt(0)=='>' ? '' : ' ')+a
          return (a = a.trim()).charAt(0) == '>' ? a.substring(1) : a;
        }, this).join(','));
        delete this.id;
        return nodes;
      }
    },
    $1: function $1(selector) {
      if (!directChildSelector.test(selector)) return this.querySelector(selector);else if (scopable) return this.querySelector(selector.split(',').map(function (a) {
        return (a = a.trim()).charAt(0) == '>' ? ':scope' + a : a;
      }).join(','));else if (this.id) {
        return this.querySelector(selector.split(',').map(function (a) {
          //return  '#'+this.id+((a=a.trim()).charAt(0)=='>' ? '' : ' ')+a
          return (a = a.trim()).charAt(0) == '>' ? a.substring(1) : a;
        }, this).join(','));
      } else {
        this.id = id;
        var nodes = this.querySelector(selector.split(',').map(function (a) {
          //return  '#'+this.id+((a=a.trim()).charAt(0)=='>' ? '' : ' ')+a
          return (a = a.trim()).charAt(0) == '>' ? a.substring(1) : a;
        }, this).join(','));
        delete this.id;
        return nodes;
      }
    },
    attr: function attr(name, value) {
      if (arguments.length == 1) {
        var attr = this.attributes.getNamedItem(name);
        return attr ? attr.value : undefined;
      } else if (value == null) this.removeAttribute(name);else this.setAttribute(name, value);
    },
    remove: Node.prototype.remove || function () {
      this.parentNode.removeChild(this);
    },
    uptrim: function uptrim() {
      var parent = this.parentNode;
      this.remove();
      if (parent.childNodes.length == 0) parent.uptrim();
    }
  });

  $tool.extend(NodeList.prototype, {
    asArray: function asArray(o) {
      o = o || [];
      for (var i = 0, len = this.length; i < len; i++) {
        o.push(this[i]);
      }return o;
    },
    forEach: Array.prototype.forEach,
    map: Array.prototype.map
  });

  return $tool;
}

if (!isNode) {
  window.$tool = makeTool.apply(undefined, _toConsumableArray(function () {
    function parser(x) {
      x = x.trim();
      if (typeof DOMParser != 'undefined') return new DOMParser().parseFromString(x, 'text/xml');

      var xmlDoc = new ActiveXObject('Microsoft.XMLDOM');
      xmlDoc.async = 'false';
      xmlDoc.loadXML(x);
      return xmlDoc;
    }

    function supportScopeSelector() {
      try {
        return document.body.querySelector(':scope>*').length != 0;
      } catch (e) {
        return false;
      }
    }
    document.$1 = document.querySelector;
    document.$ = document.querySelectorAll;
    return [parser, Document, Element, NodeList, supportScopeSelector()];
  }()));
} else {
  global.$tool = makeTool.apply(undefined, _toConsumableArray(function (xmldom) {
    var DOMParser = xmldom.DOMParser,
        DOMImplementation = xmldom.DOMImplementation;

    var nwmatcher = require('nwmatcher');

    function parse(x) {
      return new DOMParser().parseFromString(x, 'text/xml');
    }

    function addNwmatcher(document) {
      if (!document._nwmatcher) {
        document._nwmatcher = nwmatcher({ document: document });
        document._nwmatcher.configure({ UNIQUE_ID: false });
      }
      return document._nwmatcher;
    }

    var a = parse('<a></a>'),
        Document = a.constructor,
        Element = a.documentElement.constructor,
        NodeList = a.childNodes.constructor;

    Document.prototype.querySelector = Element.prototype.querySelector = function (selector) {
      return addNwmatcher(this.ownerDocument || this).first(selector, this);
    };

    Document.prototype.querySelectorAll = Element.prototype.querySelectorAll = function (selector) {
      return addNwmatcher(this.ownerDocument || this).select(selector, this);
    };

    /**
     * nwwatcher has unexpected result with namespace on nodeName
     */
    var _createElementNS = Document.prototype.createElementNS;
    Document.prototype.createElementNS = function () {
      var el = _createElementNS.apply(this, arguments);
      el.tagName = el.nodeName = el.localName;
      return el;
    };

    Object.defineProperty(Element.prototype, 'outerHTML', {
      get: function get() {
        return new xmldom.XMLSerializer().serializeToString(this);
      }
    });

    return [parse, Document, Element, NodeList, false];
  }(require('xmldom'))));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy90b29sLmpzIl0sIm5hbWVzIjpbImlzTm9kZSIsIk9iamVjdCIsInByb3RvdHlwZSIsInRvU3RyaW5nIiwiY2FsbCIsImdsb2JhbCIsInByb2Nlc3MiLCJlIiwibWFrZVRvb2wiLCJ4bWxQYXJzZXIiLCJEb2N1bWVudCIsIk5vZGUiLCJOb2RlTGlzdCIsInNjb3BhYmxlIiwiJHRvb2wiLCJwYXJzZVhNTCIsImV4dGVuZCIsImFzc2lnbiIsImlzRnVuY3Rpb24iLCJhIiwiaXNBcnJheSIsIkFycmF5IiwiZWFjaCIsImYiLCJjdHgiLCJmb3JFYWNoIiwia2V5cyIsImsiLCJtYXAiLCJ0b0FycmF5IiwiYXJncyIsImkiLCJsZW4iLCJsZW5ndGgiLCJwdXNoIiwiZGlyZWN0Q2hpbGRTZWxlY3RvciIsImlkIiwiJCIsInNlbGVjdG9yIiwidGVzdCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJzcGxpdCIsInRyaW0iLCJjaGFyQXQiLCJqb2luIiwic3Vic3RyaW5nIiwibm9kZXMiLCIkMSIsInF1ZXJ5U2VsZWN0b3IiLCJhdHRyIiwibmFtZSIsInZhbHVlIiwiYXJndW1lbnRzIiwiYXR0cmlidXRlcyIsImdldE5hbWVkSXRlbSIsInVuZGVmaW5lZCIsInJlbW92ZUF0dHJpYnV0ZSIsInNldEF0dHJpYnV0ZSIsInJlbW92ZSIsInBhcmVudE5vZGUiLCJyZW1vdmVDaGlsZCIsInVwdHJpbSIsInBhcmVudCIsImNoaWxkTm9kZXMiLCJhc0FycmF5IiwibyIsIndpbmRvdyIsInBhcnNlciIsIngiLCJET01QYXJzZXIiLCJwYXJzZUZyb21TdHJpbmciLCJ4bWxEb2MiLCJBY3RpdmVYT2JqZWN0IiwiYXN5bmMiLCJsb2FkWE1MIiwic3VwcG9ydFNjb3BlU2VsZWN0b3IiLCJkb2N1bWVudCIsImJvZHkiLCJFbGVtZW50IiwieG1sZG9tIiwiRE9NSW1wbGVtZW50YXRpb24iLCJud21hdGNoZXIiLCJyZXF1aXJlIiwicGFyc2UiLCJhZGROd21hdGNoZXIiLCJfbndtYXRjaGVyIiwiY29uZmlndXJlIiwiVU5JUVVFX0lEIiwiY29uc3RydWN0b3IiLCJkb2N1bWVudEVsZW1lbnQiLCJvd25lckRvY3VtZW50IiwiZmlyc3QiLCJzZWxlY3QiLCJfY3JlYXRlRWxlbWVudE5TIiwiY3JlYXRlRWxlbWVudE5TIiwiZWwiLCJhcHBseSIsInRhZ05hbWUiLCJub2RlTmFtZSIsImxvY2FsTmFtZSIsImRlZmluZVByb3BlcnR5IiwiZ2V0IiwiWE1MU2VyaWFsaXplciIsInNlcmlhbGl6ZVRvU3RyaW5nIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFJQSxTQUFTLEtBQWI7QUFDQSxJQUFJO0FBQ0ZBLFdBQ0VDLE9BQU9DLFNBQVAsQ0FBaUJDLFFBQWpCLENBQTBCQyxJQUExQixDQUErQkMsT0FBT0MsT0FBdEMsTUFBbUQsa0JBRHJEO0FBRUQsQ0FIRCxDQUdFLE9BQU9DLENBQVAsRUFBVSxDQUFFOztBQUVkLFNBQVNDLFFBQVQsQ0FBa0JDLFNBQWxCLEVBQTZCQyxRQUE3QixFQUF1Q0MsSUFBdkMsRUFBNkNDLFFBQTdDLEVBQXVEQyxRQUF2RCxFQUFpRTtBQUMvRCxNQUFJQyxRQUFRO0FBQ1ZkLGtCQURVO0FBRVZlLGNBQVVOLFNBRkE7QUFHVk8sWUFBUWYsT0FBT2dCLE1BSEw7QUFJVkMsZ0JBQVksb0JBQVVDLENBQVYsRUFBYTtBQUN2QixhQUFPLE9BQU9BLENBQVAsS0FBYSxVQUFwQjtBQUNELEtBTlM7QUFPVkMsYUFBUyxpQkFBVUQsQ0FBVixFQUFhO0FBQ3BCLGFBQU9FLE1BQU1ELE9BQU4sQ0FBY0QsQ0FBZCxDQUFQO0FBQ0QsS0FUUztBQVVWRyxVQUFNLGNBQVVILENBQVYsRUFBYUksQ0FBYixFQUFnQkMsR0FBaEIsRUFBcUI7QUFDekIsVUFBSUgsTUFBTUQsT0FBTixDQUFjRCxDQUFkLENBQUosRUFBc0I7QUFDcEJBLFVBQUVNLE9BQUYsQ0FBVUYsQ0FBVixFQUFhQyxHQUFiO0FBQ0QsT0FGRCxNQUVPLElBQUksUUFBT0wsQ0FBUCx5Q0FBT0EsQ0FBUCxPQUFhLFFBQWpC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QUlDLEtBQUtGLGlCQUFpQkcsS0FBakIsQ0FBdUIsSUFBdkIsRUFBNkI1QyxTQUE3QixDQUFUO0FBQ0EyQyxTQUFHRSxPQUFILEdBQWFGLEdBQUdHLFFBQUgsR0FBY0gsR0FBR0ksU0FBOUI7QUFDQSxhQUFPSixFQUFQO0FBQ0QsS0FKRDs7QUFNQTlGLFdBQU9tRyxjQUFQLENBQXNCdEIsUUFBUTVFLFNBQTlCLEVBQXlDLFdBQXpDLEVBQXNEO0FBQ3BEbUcsV0FBSyxlQUFZO0FBQ2YsZUFBTyxJQUFJdEIsT0FBT3VCLGFBQVgsR0FBMkJDLGlCQUEzQixDQUE2QyxJQUE3QyxDQUFQO0FBQ0Q7QUFIbUQsS0FBdEQ7O0FBTUEsV0FBTyxDQUFDcEIsS0FBRCxFQUFRekUsUUFBUixFQUFrQm9FLE9BQWxCLEVBQTJCbEUsUUFBM0IsRUFBcUMsS0FBckMsQ0FBUDtBQUNELEdBcERFLENBb0RBc0UsUUFBUSxRQUFSLENBcERBLENBRFUsRUFBZjtBQXVERCIsImZpbGUiOiJ0b29sLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGlzTm9kZSA9IGZhbHNlO1xudHJ5IHtcbiAgaXNOb2RlID1cbiAgICBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZ2xvYmFsLnByb2Nlc3MpID09PSAnW29iamVjdCBwcm9jZXNzXSc7XG59IGNhdGNoIChlKSB7fVxuXG5mdW5jdGlvbiBtYWtlVG9vbCh4bWxQYXJzZXIsIERvY3VtZW50LCBOb2RlLCBOb2RlTGlzdCwgc2NvcGFibGUpIHtcbiAgdmFyICR0b29sID0ge1xuICAgIGlzTm9kZSxcbiAgICBwYXJzZVhNTDogeG1sUGFyc2VyLFxuICAgIGV4dGVuZDogT2JqZWN0LmFzc2lnbixcbiAgICBpc0Z1bmN0aW9uOiBmdW5jdGlvbiAoYSkge1xuICAgICAgcmV0dXJuIHR5cGVvZiBhID09PSAnZnVuY3Rpb24nO1xuICAgIH0sXG4gICAgaXNBcnJheTogZnVuY3Rpb24gKGEpIHtcbiAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KGEpO1xuICAgIH0sXG4gICAgZWFjaDogZnVuY3Rpb24gKGEsIGYsIGN0eCkge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYSkpIHtcbiAgICAgICAgYS5mb3JFYWNoKGYsIGN0eCk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBhID09PSAnb2JqZWN0Jykge1xuICAgICAgICBPYmplY3Qua2V5cyhhKS5mb3JFYWNoKGZ1bmN0aW9uIChrKSB7XG4gICAgICAgICAgZi5jYWxsKGN0eCwgaywgYVtrXSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFwOiBmdW5jdGlvbiAoYSwgZiwgY3R4KSB7XG4gICAgICByZXR1cm4gYS5tYXAoZiwgY3R4KTtcbiAgICB9LFxuICB9O1xuXG4gICR0b29sLmV4dGVuZCgkdG9vbCwge1xuICAgIHRvQXJyYXk6IGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICB2YXIgYSA9IFtdO1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFyZ3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIGEucHVzaChhcmdzW2ldKTtcbiAgICAgIHJldHVybiBhO1xuICAgIH0sXG4gIH0pO1xuXG4gIHZhciBkaXJlY3RDaGlsZFNlbGVjdG9yID0gLygoXnwsKVxccyo+KS8sXG4gICAgaWQgPSAnc3h4eCc7XG4gICR0b29sLmV4dGVuZChOb2RlLnByb3RvdHlwZSwge1xuICAgICQ6IGZ1bmN0aW9uIChzZWxlY3Rvcikge1xuICAgICAgaWYgKCFkaXJlY3RDaGlsZFNlbGVjdG9yLnRlc3Qoc2VsZWN0b3IpKVxuICAgICAgICByZXR1cm4gdGhpcy5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTtcbiAgICAgIGVsc2UgaWYgKHNjb3BhYmxlKVxuICAgICAgICByZXR1cm4gdGhpcy5xdWVyeVNlbGVjdG9yQWxsKFxuICAgICAgICAgIHNlbGVjdG9yXG4gICAgICAgICAgICAuc3BsaXQoJywnKVxuICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgICByZXR1cm4gYS50cmltKCkuY2hhckF0KDApID09ICc+JyA/ICc6c2NvcGUnICsgYSA6IGE7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmpvaW4oJywnKVxuICAgICAgICApO1xuICAgICAgZWxzZSBpZiAodGhpcy5pZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5xdWVyeVNlbGVjdG9yQWxsKFxuICAgICAgICAgIHNlbGVjdG9yXG4gICAgICAgICAgICAuc3BsaXQoJywnKVxuICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgICAvL3JldHVybiAgJyMnK3RoaXMuaWQrKChhPWEudHJpbSgpKS5jaGFyQXQoMCk9PSc+JyA/ICcnIDogJyAnKSthXG4gICAgICAgICAgICAgIHJldHVybiAoYSA9IGEudHJpbSgpKS5jaGFyQXQoMCkgPT0gJz4nID8gYS5zdWJzdHJpbmcoMSkgOiBhO1xuICAgICAgICAgICAgfSwgdGhpcylcbiAgICAgICAgICAgIC5qb2luKCcsJylcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgdmFyIG5vZGVzID0gdGhpcy5xdWVyeVNlbGVjdG9yQWxsKFxuICAgICAgICAgIHNlbGVjdG9yXG4gICAgICAgICAgICAuc3BsaXQoJywnKVxuICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgICAvL0lFIGNhbid0IGZpbmQgJyN4eCcsIEB0b2RvOiBmaXggaXQgbGF0ZXJcbiAgICAgICAgICAgICAgLy9yZXR1cm4gICcjJyt0aGlzLmlkKygoYT1hLnRyaW0oKSkuY2hhckF0KDApPT0nPicgPyAnJyA6ICcgJykrYVxuICAgICAgICAgICAgICByZXR1cm4gKGEgPSBhLnRyaW0oKSkuY2hhckF0KDApID09ICc+JyA/IGEuc3Vic3RyaW5nKDEpIDogYTtcbiAgICAgICAgICAgIH0sIHRoaXMpXG4gICAgICAgICAgICAuam9pbignLCcpXG4gICAgICAgICk7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmlkO1xuICAgICAgICByZXR1cm4gbm9kZXM7XG4gICAgICB9XG4gICAgfSxcbiAgICAkMTogZnVuY3Rpb24gKHNlbGVjdG9yKSB7XG4gICAgICBpZiAoIWRpcmVjdENoaWxkU2VsZWN0b3IudGVzdChzZWxlY3RvcikpXG4gICAgICAgIHJldHVybiB0aGlzLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xuICAgICAgZWxzZSBpZiAoc2NvcGFibGUpXG4gICAgICAgIHJldHVybiB0aGlzLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgc2VsZWN0b3JcbiAgICAgICAgICAgIC5zcGxpdCgnLCcpXG4gICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICAgIHJldHVybiAoYSA9IGEudHJpbSgpKS5jaGFyQXQoMCkgPT0gJz4nID8gJzpzY29wZScgKyBhIDogYTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuam9pbignLCcpXG4gICAgICAgICk7XG4gICAgICBlbHNlIGlmICh0aGlzLmlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgc2VsZWN0b3JcbiAgICAgICAgICAgIC5zcGxpdCgnLCcpXG4gICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICAgIC8vcmV0dXJuICAnIycrdGhpcy5pZCsoKGE9YS50cmltKCkpLmNoYXJBdCgwKT09Jz4nID8gJycgOiAnICcpK2FcbiAgICAgICAgICAgICAgcmV0dXJuIChhID0gYS50cmltKCkpLmNoYXJBdCgwKSA9PSAnPicgPyBhLnN1YnN0cmluZygxKSA6IGE7XG4gICAgICAgICAgICB9LCB0aGlzKVxuICAgICAgICAgICAgLmpvaW4oJywnKVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB2YXIgbm9kZXMgPSB0aGlzLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgc2VsZWN0b3JcbiAgICAgICAgICAgIC5zcGxpdCgnLCcpXG4gICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICAgIC8vcmV0dXJuICAnIycrdGhpcy5pZCsoKGE9YS50cmltKCkpLmNoYXJBdCgwKT09Jz4nID8gJycgOiAnICcpK2FcbiAgICAgICAgICAgICAgcmV0dXJuIChhID0gYS50cmltKCkpLmNoYXJBdCgwKSA9PSAnPicgPyBhLnN1YnN0cmluZygxKSA6IGE7XG4gICAgICAgICAgICB9LCB0aGlzKVxuICAgICAgICAgICAgLmpvaW4oJywnKVxuICAgICAgICApO1xuICAgICAgICBkZWxldGUgdGhpcy5pZDtcbiAgICAgICAgcmV0dXJuIG5vZGVzO1xuICAgICAgfVxuICAgIH0sXG4gICAgYXR0cjogZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XG4gICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgIHZhciBhdHRyID0gdGhpcy5hdHRyaWJ1dGVzLmdldE5hbWVkSXRlbShuYW1lKTtcbiAgICAgICAgcmV0dXJuIGF0dHIgPyBhdHRyLnZhbHVlIDogdW5kZWZpbmVkO1xuICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PSBudWxsKSB0aGlzLnJlbW92ZUF0dHJpYnV0ZShuYW1lKTtcbiAgICAgIGVsc2UgdGhpcy5zZXRBdHRyaWJ1dGUobmFtZSwgdmFsdWUpO1xuICAgIH0sXG4gICAgcmVtb3ZlOlxuICAgICAgTm9kZS5wcm90b3R5cGUucmVtb3ZlIHx8XG4gICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzKTtcbiAgICAgIH0sXG4gICAgdXB0cmltOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgcGFyZW50ID0gdGhpcy5wYXJlbnROb2RlO1xuICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgIGlmIChwYXJlbnQuY2hpbGROb2Rlcy5sZW5ndGggPT0gMCkgcGFyZW50LnVwdHJpbSgpO1xuICAgIH0sXG4gIH0pO1xuXG4gICR0b29sLmV4dGVuZChOb2RlTGlzdC5wcm90b3R5cGUsIHtcbiAgICBhc0FycmF5OiBmdW5jdGlvbiAobykge1xuICAgICAgbyA9IG8gfHwgW107XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgby5wdXNoKHRoaXNbaV0pO1xuICAgICAgcmV0dXJuIG87XG4gICAgfSxcbiAgICBmb3JFYWNoOiBBcnJheS5wcm90b3R5cGUuZm9yRWFjaCxcbiAgICBtYXA6IEFycmF5LnByb3RvdHlwZS5tYXAsXG4gIH0pO1xuXG4gIHJldHVybiAkdG9vbDtcbn1cblxuaWYgKCFpc05vZGUpIHtcbiAgd2luZG93LiR0b29sID0gbWFrZVRvb2woXG4gICAgLi4uKGZ1bmN0aW9uICgpIHtcbiAgICAgIGZ1bmN0aW9uIHBhcnNlcih4KSB7XG4gICAgICAgIHggPSB4LnRyaW0oKTtcbiAgICAgICAgaWYgKHR5cGVvZiBET01QYXJzZXIgIT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgcmV0dXJuIG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoeCwgJ3RleHQveG1sJyk7XG5cbiAgICAgICAgdmFyIHhtbERvYyA9IG5ldyBBY3RpdmVYT2JqZWN0KCdNaWNyb3NvZnQuWE1MRE9NJyk7XG4gICAgICAgIHhtbERvYy5hc3luYyA9ICdmYWxzZSc7XG4gICAgICAgIHhtbERvYy5sb2FkWE1MKHgpO1xuICAgICAgICByZXR1cm4geG1sRG9jO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBzdXBwb3J0U2NvcGVTZWxlY3RvcigpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZXR1cm4gZG9jdW1lbnQuYm9keS5xdWVyeVNlbGVjdG9yKCc6c2NvcGU+KicpLmxlbmd0aCAhPSAwO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBkb2N1bWVudC4kMSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3I7XG4gICAgICBkb2N1bWVudC4kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbDtcbiAgICAgIHJldHVybiBbcGFyc2VyLCBEb2N1bWVudCwgRWxlbWVudCwgTm9kZUxpc3QsIHN1cHBvcnRTY29wZVNlbGVjdG9yKCldO1xuICAgIH0pKClcbiAgKTtcbn0gZWxzZSB7XG4gIGdsb2JhbC4kdG9vbCA9IG1ha2VUb29sKFxuICAgIC4uLihmdW5jdGlvbiAoeG1sZG9tKSB7XG4gICAgICB2YXIgRE9NUGFyc2VyID0geG1sZG9tLkRPTVBhcnNlcixcbiAgICAgICAgRE9NSW1wbGVtZW50YXRpb24gPSB4bWxkb20uRE9NSW1wbGVtZW50YXRpb247XG5cbiAgICAgIHZhciBud21hdGNoZXIgPSByZXF1aXJlKCdud21hdGNoZXInKTtcblxuICAgICAgZnVuY3Rpb24gcGFyc2UoeCkge1xuICAgICAgICByZXR1cm4gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyh4LCAndGV4dC94bWwnKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gYWRkTndtYXRjaGVyKGRvY3VtZW50KSB7XG4gICAgICAgIGlmICghZG9jdW1lbnQuX253bWF0Y2hlcikge1xuICAgICAgICAgIGRvY3VtZW50Ll9ud21hdGNoZXIgPSBud21hdGNoZXIoeyBkb2N1bWVudDogZG9jdW1lbnQgfSk7XG4gICAgICAgICAgZG9jdW1lbnQuX253bWF0Y2hlci5jb25maWd1cmUoeyBVTklRVUVfSUQ6IGZhbHNlIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkb2N1bWVudC5fbndtYXRjaGVyO1xuICAgICAgfVxuXG4gICAgICB2YXIgYSA9IHBhcnNlKCc8YT48L2E+JyksXG4gICAgICAgIERvY3VtZW50ID0gYS5jb25zdHJ1Y3RvcixcbiAgICAgICAgRWxlbWVudCA9IGEuZG9jdW1lbnRFbGVtZW50LmNvbnN0cnVjdG9yLFxuICAgICAgICBOb2RlTGlzdCA9IGEuY2hpbGROb2Rlcy5jb25zdHJ1Y3RvcjtcblxuICAgICAgRG9jdW1lbnQucHJvdG90eXBlLnF1ZXJ5U2VsZWN0b3IgPSBFbGVtZW50LnByb3RvdHlwZS5xdWVyeVNlbGVjdG9yID0gZnVuY3Rpb24gKFxuICAgICAgICBzZWxlY3RvclxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBhZGROd21hdGNoZXIodGhpcy5vd25lckRvY3VtZW50IHx8IHRoaXMpLmZpcnN0KHNlbGVjdG9yLCB0aGlzKTtcbiAgICAgIH07XG5cbiAgICAgIERvY3VtZW50LnByb3RvdHlwZS5xdWVyeVNlbGVjdG9yQWxsID0gRWxlbWVudC5wcm90b3R5cGUucXVlcnlTZWxlY3RvckFsbCA9IGZ1bmN0aW9uIChcbiAgICAgICAgc2VsZWN0b3JcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gYWRkTndtYXRjaGVyKHRoaXMub3duZXJEb2N1bWVudCB8fCB0aGlzKS5zZWxlY3Qoc2VsZWN0b3IsIHRoaXMpO1xuICAgICAgfTtcblxuICAgICAgLyoqXG4gICAgICAgKiBud3dhdGNoZXIgaGFzIHVuZXhwZWN0ZWQgcmVzdWx0IHdpdGggbmFtZXNwYWNlIG9uIG5vZGVOYW1lXG4gICAgICAgKi9cbiAgICAgIHZhciBfY3JlYXRlRWxlbWVudE5TID0gRG9jdW1lbnQucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnROUztcbiAgICAgIERvY3VtZW50LnByb3RvdHlwZS5jcmVhdGVFbGVtZW50TlMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBlbCA9IF9jcmVhdGVFbGVtZW50TlMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgZWwudGFnTmFtZSA9IGVsLm5vZGVOYW1lID0gZWwubG9jYWxOYW1lO1xuICAgICAgICByZXR1cm4gZWw7XG4gICAgICB9O1xuXG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoRWxlbWVudC5wcm90b3R5cGUsICdvdXRlckhUTUwnLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBuZXcgeG1sZG9tLlhNTFNlcmlhbGl6ZXIoKS5zZXJpYWxpemVUb1N0cmluZyh0aGlzKTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gW3BhcnNlLCBEb2N1bWVudCwgRWxlbWVudCwgTm9kZUxpc3QsIGZhbHNlXTtcbiAgICB9KShyZXF1aXJlKCd4bWxkb20nKSlcbiAgKTtcbn1cbiJdfQ==
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _model = require('./model');

var _model2 = _interopRequireDefault(_model);

var _document = require('../document');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

function attr(node) {
  var name = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'w:val';

  return node ? node.attr(name) : undefined;
}

var Factory = function (_Base) {
  _inherits(Factory, _Base);

  function Factory() {
    _classCallCheck(this, Factory);

    return _possibleConstructorReturn(this, (Factory.__proto__ || Object.getPrototypeOf(Factory)).apply(this, arguments));
  }

  _createClass(Factory, [{
    key: 'create',
    value: function create(wXml, doc, parent, more) {
      var tag = wXml.localName,
          swap;

      if ('document' == tag) return new (require('./model/document'))(wXml, doc, parent);else if ('styles' == tag) return new (require('./model/documentStyles'))(wXml, doc);else if ('abstractNum' == tag) return new (require('./model/style/numberingDefinition'))(wXml, doc);else if ('num' == tag) return new (require('./model/style/list'))(wXml, doc);else if ('style' == tag) {
        switch (wXml.attr('w:type')) {
          case 'paragraph':
            return new (require('./model/style/paragraph'))(wXml, doc);
          case 'character':
            return new (require('./model/style/inline'))(wXml, doc);
          case 'table':
            return new (require('./model/style/table'))(wXml, doc);
          case 'numbering':
            return new (require('./model/style/numbering'))(wXml, doc);
        }
      } else if ('docDefaults' == tag) return new (require('./model/style/document'))(wXml, doc);else if ('body' == tag) return new (require('./model/body'))(wXml, doc, parent);else if ('p' == tag) {
        var styleId = attr(wXml.$1('>pPr>pStyle'), 'w:val'),
            style = doc.style.get(styleId);
        if (wXml.$1('>pPr>numPr') || style && style.getNumId() != -1) return new (require('./model/list'))(wXml, doc, parent);

        var outlineLvl = -1,
            tmp = void 0;
        if (style) outlineLvl = style.getOutlineLevel();else if (tmp = wXml.$1('>pPr>outlineLvl')) {
          tmp = parseInt(attr(tmp));
          outlineLvl = parseInt(tmp);
        }

        if (outlineLvl != -1) return new (require('./model/heading'))(wXml, doc, parent, outlineLvl);

        return new (require('./model/paragraph'))(wXml, doc, parent);
      } else if ('r' == tag) {
        var _style = doc.style.get(attr(wXml.$1('>rPr>rStyle'), 'w:val'));

        var _outlineLvl = -1,
            _tmp = void 0;
        if (_style) _outlineLvl = _style.getOutlineLevel();else if (_tmp = wXml.$1('>rPr>outlineLvl')) {
          _tmp = attr(_tmp);
          _outlineLvl = parseInt(_tmp);
        }

        if (_outlineLvl != -1) return new (require('./model/headingInline'))(wXml, doc, parent, _outlineLvl);

        if (wXml.childNodes.length == 1 || wXml.childNodes == 2 && wXml.firstChild.localName == 'rPr') {
          switch (wXml.lastChild.localName) {
            case 'fldChar':
            case 'instrText':
              return factory(wXml.lastChild, doc, parent);
          }
        }

        return new (require('./model/inline'))(wXml, doc, parent);
      } else if ('instrText' == tag) return new (require('./model/fieldInstruct'))(wXml, doc, parent);else if ('t' == tag) return new (require('./model/text'))(wXml, doc, parent);else if ('sym' == tag && wXml.parentNode.localName == 'r') return new (require('./model/symbol'))(wXml, doc, parent);else if ('softHyphen' == tag && wXml.parentNode.localName == 'r') return new (require('./model/softHyphen'))(wXml, doc, parent);else if ('noBreakHyphen' == tag && wXml.parentNode.localName == 'r') return new (require('./model/noBreakHyphen'))(wXml, doc, parent);else if ('tab' == tag && wXml.parentNode.localName == 'r') return new (require('./model/tab'))(wXml, doc, parent);else if ('fldSimple' == tag) return new (require('./model/fieldSimple'))(wXml, doc, parent);else if ('fldChar' == tag) {
        switch (wXml.attr('w:fldCharType')) {
          case 'begin':
            return new (require('./model/fieldBegin'))(wXml, doc, parent);
            break;
          case 'end':
            return new (require('./model/fieldEnd'))(wXml, doc, parent);
            break;
          case 'separate':
            return new (require('./model/fieldSeparate'))(wXml, doc, parent);
            break;
        }
      } else if ('tbl' == tag) return new (require('./model/table'))(wXml, doc, parent);else if ('tr' == tag) return new (require('./model/row'))(wXml, doc, parent);else if ('tc' == tag) return new (require('./model/cell'))(wXml, doc, parent);else if ('br' == tag) return new (require('./model/br'))(wXml, doc, parent);else if ('hyperlink' == tag && 'p' == wXml.parentNode.localName) return new (require('./model/hyperlink'))(wXml, doc, parent);else if ('AlternateContent' == tag) return new (require('./model/drawingAnchor'))(wXml, doc, parent);else if ('wsp' == tag) return new (require('./model/shape'))(wXml, doc, parent);else if ('inline' == tag) {
        var type = wXml.$1('>graphic>graphicData').attr('uri').split('/').pop();
        switch (type) {
          case 'picture':
            return new (require('./model/image'))(wXml, doc, parent);
          case 'diagram':
            return new (require('./model/diagram'))(wXml, doc, parent);
          case 'chart':
            return new (require('./model/chart'))(wXml, doc, parent);
          default:
            console.error('inline ' + type + ' is not suppored yet.');
        }
      } else if ('sdt' == tag) {
        var elBinding = wXml.$1('>sdtPr>dataBinding');
        if (elBinding) {
          //properties
          var path = attr(elBinding, 'w:xpath'),
              d = path.split(/[\/\:\[]/),
              name = (d.pop(), d.pop());
          return new (require('./model/documentProperty'))(wXml, doc, parent, name);
        } else {
          //controls
          var elType = wXml.$1('>sdtPr').$1('text, picture, docPartList, comboBox, dropDownList, date, checkbox');
          tag = elType ? elType.localName : 'richtext';

          var control = this.createControl.apply(this, [tag].concat(Array.prototype.slice.call(arguments)));

          if (control) return control;
        }
      } else if ('bookmarkStart' == tag) return new (require('./model/bookmarkStart'))(wXml, doc, parent);else if ('bookmarkEnd' == tag) return new (require('./model/bookmarkEnd'))(wXml, doc, parent);else if ('oMath' == tag) return new (require('./model/equation'))(wXml, doc, parent);else if ('object' == tag) return new (require('./model/OLE'))(wXml, doc, parent);else if ('sectPr' == tag) return new (require('./model/section'))(wXml, doc, parent);

      return new _model2.default(wXml, doc, parent);
    }
  }, {
    key: 'createControl',
    value: function createControl(type, wXml, doc, parent) {
      if ('text' == type) return new (require('./model/control/text'))(wXml, doc, parent);else if ('picture' == type) return new (require('./model/control/picture'))(wXml, doc, parent);else if ('docPartList' == type) return new (require('./model/control/gallery'))(wXml, doc, parent);else if ('comboBox' == type) return new (require('./model/control/combobox'))(wXml, doc, parent);else if ('dropDownList' == type) return new (require('./model/control/dropdown'))(wXml, doc, parent);else if ('date' == type) return new (require('./model/control/date'))(wXml, doc, parent);else if ('checkbox' == type) return new (require('./model/control/checkbox'))(wXml, doc, parent);else if ('richtext' == type) return new (require('./model/control/richtext'))(wXml, doc, parent);
    }
  }]);

  return Factory;
}(_document.Factory);

exports.default = Factory;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9vcGVueG1sL2RvY3gvZmFjdG9yeS5qcyJdLCJuYW1lcyI6WyJhdHRyIiwibm9kZSIsIm5hbWUiLCJ1bmRlZmluZWQiLCJGYWN0b3J5Iiwid1htbCIsImRvYyIsInBhcmVudCIsIm1vcmUiLCJ0YWciLCJsb2NhbE5hbWUiLCJzd2FwIiwicmVxdWlyZSIsInN0eWxlSWQiLCIkMSIsInN0eWxlIiwiZ2V0IiwiZ2V0TnVtSWQiLCJvdXRsaW5lTHZsIiwidG1wIiwiZ2V0T3V0bGluZUxldmVsIiwicGFyc2VJbnQiLCJjaGlsZE5vZGVzIiwibGVuZ3RoIiwiZmlyc3RDaGlsZCIsImxhc3RDaGlsZCIsImZhY3RvcnkiLCJwYXJlbnROb2RlIiwidHlwZSIsInNwbGl0IiwicG9wIiwiY29uc29sZSIsImVycm9yIiwiZWxCaW5kaW5nIiwicGF0aCIsImQiLCJlbFR5cGUiLCJjb250cm9sIiwiY3JlYXRlQ29udHJvbCIsImFyZ3VtZW50cyIsIk1vZGVsIiwiQmFzZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTs7OztBQUNBOzs7Ozs7Ozs7O0FBRUEsU0FBU0EsSUFBVCxDQUFjQyxJQUFkLEVBQW9DO0FBQUEsTUFBaEJDLElBQWdCLHVFQUFULE9BQVM7O0FBQ2xDLFNBQU9ELE9BQU9BLEtBQUtELElBQUwsQ0FBVUUsSUFBVixDQUFQLEdBQXlCQyxTQUFoQztBQUNEOztJQUVvQkMsTzs7Ozs7Ozs7Ozs7MkJBQ1pDLEksRUFBTUMsRyxFQUFLQyxNLEVBQVFDLEksRUFBTTtBQUM5QixVQUFJQyxNQUFNSixLQUFLSyxTQUFmO0FBQUEsVUFDRUMsSUFERjs7QUFHQSxVQUFJLGNBQWNGLEdBQWxCLEVBQ0UsT0FBTyxLQUFLRyxRQUFRLGtCQUFSLENBQUwsRUFBa0NQLElBQWxDLEVBQXdDQyxHQUF4QyxFQUE2Q0MsTUFBN0MsQ0FBUCxDQURGLEtBRUssSUFBSSxZQUFZRSxHQUFoQixFQUNILE9BQU8sS0FBS0csUUFBUSx3QkFBUixDQUFMLEVBQXdDUCxJ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QU8sS0FBS2hCLFFBQVEseUJBQVIsQ0FBTCxFQUF5Q1AsSUFBekMsRUFBK0NDLEdBQS9DLEVBQW9EQyxNQUFwRCxDQUFQLENBREcsS0FFQSxJQUFJLGNBQWNxQixJQUFsQixFQUNILE9BQU8sS0FBS2hCLFFBQVEsMEJBQVIsQ0FBTCxFQUEwQ1AsSUFBMUMsRUFBZ0RDLEdBQWhELEVBQXFEQyxNQUFyRCxDQUFQLENBREcsS0FFQSxJQUFJLGtCQUFrQnFCLElBQXRCLEVBQ0gsT0FBTyxLQUFLaEIsUUFBUSwwQkFBUixDQUFMLEVBQTBDUCxJQUExQyxFQUFnREMsR0FBaEQsRUFBcURDLE1BQXJELENBQVAsQ0FERyxLQUVBLElBQUksVUFBVXFCLElBQWQsRUFDSCxPQUFPLEtBQUtoQixRQUFRLHNCQUFSLENBQUwsRUFBc0NQLElBQXRDLEVBQTRDQyxHQUE1QyxFQUFpREMsTUFBakQsQ0FBUCxDQURHLEtBRUEsSUFBSSxjQUFjcUIsSUFBbEIsRUFDSCxPQUFPLEtBQUtoQixRQUFRLDBCQUFSLENBQUwsRUFBMENQLElBQTFDLEVBQWdEQyxHQUFoRCxFQUFxREMsTUFBckQsQ0FBUCxDQURHLEtBRUEsSUFBSSxjQUFjcUIsSUFBbEIsRUFDSCxPQUFPLEtBQUtoQixRQUFRLDBCQUFSLENBQUwsRUFBMENQLElBQTFDLEVBQWdEQyxHQUFoRCxFQUFxREMsTUFBckQsQ0FBUDtBQUNIOzs7O0VBekxrQ2tDLGlCOztrQkFBaEJyQyxPIiwiZmlsZSI6ImZhY3RvcnkuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTW9kZWwgZnJvbSAnLi9tb2RlbCc7XG5pbXBvcnQgeyBGYWN0b3J5IGFzIEJhc2UgfSBmcm9tICcuLi9kb2N1bWVudCc7XG5cbmZ1bmN0aW9uIGF0dHIobm9kZSwgbmFtZSA9ICd3OnZhbCcpIHtcbiAgcmV0dXJuIG5vZGUgPyBub2RlLmF0dHIobmFtZSkgOiB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEZhY3RvcnkgZXh0ZW5kcyBCYXNlIHtcbiAgY3JlYXRlKHdYbWwsIGRvYywgcGFyZW50LCBtb3JlKSB7XG4gICAgdmFyIHRhZyA9IHdYbWwubG9jYWxOYW1lLFxuICAgICAgc3dhcDtcblxuICAgIGlmICgnZG9jdW1lbnQnID09IHRhZylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvZG9jdW1lbnQnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdzdHlsZXMnID09IHRhZylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvZG9jdW1lbnRTdHlsZXMnKSkod1htbCwgZG9jKTtcbiAgICBlbHNlIGlmICgnYWJzdHJhY3ROdW0nID09IHRhZylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvc3R5bGUvbnVtYmVyaW5nRGVmaW5pdGlvbicpKSh3WG1sLCBkb2MpO1xuICAgIGVsc2UgaWYgKCdudW0nID09IHRhZylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvc3R5bGUvbGlzdCcpKSh3WG1sLCBkb2MpO1xuICAgIGVsc2UgaWYgKCdzdHlsZScgPT0gdGFnKSB7XG4gICAgICBzd2l0Y2ggKHdYbWwuYXR0cigndzp0eXBlJykpIHtcbiAgICAgICAgY2FzZSAncGFyYWdyYXBoJzpcbiAgICAgICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL3N0eWxlL3BhcmFncmFwaCcpKSh3WG1sLCBkb2MpO1xuICAgICAgICBjYXNlICdjaGFyYWN0ZXInOlxuICAgICAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvc3R5bGUvaW5saW5lJykpKHdYbWwsIGRvYyk7XG4gICAgICAgIGNhc2UgJ3RhYmxlJzpcbiAgICAgICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL3N0eWxlL3RhYmxlJykpKHdYbWwsIGRvYyk7XG4gICAgICAgIGNhc2UgJ251bWJlcmluZyc6XG4gICAgICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9zdHlsZS9udW1iZXJpbmcnKSkod1htbCwgZG9jKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCdkb2NEZWZhdWx0cycgPT0gdGFnKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9zdHlsZS9kb2N1bWVudCcpKSh3WG1sLCBkb2MpO1xuICAgIGVsc2UgaWYgKCdib2R5JyA9PSB0YWcpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2JvZHknKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdwJyA9PSB0YWcpIHtcbiAgICAgIHZhciBzdHlsZUlkID0gYXR0cih3WG1sLiQxKCc+cFByPnBTdHlsZScpLCAndzp2YWwnKSxcbiAgICAgICAgc3R5bGUgPSBkb2Muc3R5bGUuZ2V0KHN0eWxlSWQpO1xuICAgICAgaWYgKHdYbWwuJDEoJz5wUHI+bnVtUHInKSB8fCAoc3R5bGUgJiYgc3R5bGUuZ2V0TnVtSWQoKSAhPSAtMSkpXG4gICAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvbGlzdCcpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG5cbiAgICAgIGxldCBvdXRsaW5lTHZsID0gLTEsXG4gICAgICAgIHRtcDtcbiAgICAgIGlmIChzdHlsZSkgb3V0bGluZUx2bCA9IHN0eWxlLmdldE91dGxpbmVMZXZlbCgpO1xuICAgICAgZWxzZSBpZiAoKHRtcCA9IHdYbWwuJDEoJz5wUHI+b3V0bGluZUx2bCcpKSkge1xuICAgICAgICB0bXAgPSBwYXJzZUludChhdHRyKHRtcCkpO1xuICAgICAgICBvdXRsaW5lTHZsID0gcGFyc2VJbnQodG1wKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG91dGxpbmVMdmwgIT0gLTEpXG4gICAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvaGVhZGluZycpKSh3WG1sLCBkb2MsIHBhcmVudCwgb3V0bGluZUx2bCk7XG5cbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvcGFyYWdyYXBoJykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICB9IGVsc2UgaWYgKCdyJyA9PSB0YWcpIHtcbiAgICAgIGxldCBzdHlsZSA9IGRvYy5zdHlsZS5nZXQoYXR0cih3WG1sLiQxKCc+clByPnJTdHlsZScpLCAndzp2YWwnKSk7XG5cbiAgICAgIGxldCBvdXRsaW5lTHZsID0gLTEsXG4gICAgICAgIHRtcDtcbiAgICAgIGlmIChzdHlsZSkgb3V0bGluZUx2bCA9IHN0eWxlLmdldE91dGxpbmVMZXZlbCgpO1xuICAgICAgZWxzZSBpZiAoKHRtcCA9IHdYbWwuJDEoJz5yUHI+b3V0bGluZUx2bCcpKSkge1xuICAgICAgICB0bXAgPSBhdHRyKHRtcCk7XG4gICAgICAgIG91dGxpbmVMdmwgPSBwYXJzZUludCh0bXApO1xuICAgICAgfVxuXG4gICAgICBpZiAob3V0bGluZUx2bCAhPSAtMSlcbiAgICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9oZWFkaW5nSW5saW5lJykpKFxuICAgICAgICAgIHdYbWwsXG4gICAgICAgICAgZG9jLFxuICAgICAgICAgIHBhcmVudCxcbiAgICAgICAgICBvdXRsaW5lTHZsXG4gICAgICAgICk7XG5cbiAgICAgIGlmIChcbiAgICAgICAgd1htbC5jaGlsZE5vZGVzLmxlbmd0aCA9PSAxIHx8XG4gICAgICAgICh3WG1sLmNoaWxkTm9kZXMgPT0gMiAmJiB3WG1sLmZpcnN0Q2hpbGQubG9jYWxOYW1lID09ICdyUHInKVxuICAgICAgKSB7XG4gICAgICAgIHN3aXRjaCAod1htbC5sYXN0Q2hpbGQubG9jYWxOYW1lKSB7XG4gICAgICAgICAgY2FzZSAnZmxkQ2hhcic6XG4gICAgICAgICAgY2FzZSAnaW5zdHJUZXh0JzpcbiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5KHdYbWwubGFzdENoaWxkLCBkb2MsIHBhcmVudCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9pbmxpbmUnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIH0gZWxzZSBpZiAoJ2luc3RyVGV4dCcgPT0gdGFnKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9maWVsZEluc3RydWN0JykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgndCcgPT0gdGFnKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC90ZXh0JykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgnc3ltJyA9PSB0YWcgJiYgd1htbC5wYXJlbnROb2RlLmxvY2FsTmFtZSA9PSAncicpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL3N5bWJvbCcpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ3NvZnRIeXBoZW4nID09IHRhZyAmJiB3WG1sLnBhcmVudE5vZGUubG9jYWxOYW1lID09ICdyJylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvc29mdEh5cGhlbicpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ25vQnJlYWtIeXBoZW4nID09IHRhZyAmJiB3WG1sLnBhcmVudE5vZGUubG9jYWxOYW1lID09ICdyJylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvbm9CcmVha0h5cGhlbicpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ3RhYicgPT0gdGFnICYmIHdYbWwucGFyZW50Tm9kZS5sb2NhbE5hbWUgPT0gJ3InKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC90YWInKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdmbGRTaW1wbGUnID09IHRhZylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvZmllbGRTaW1wbGUnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdmbGRDaGFyJyA9PSB0YWcpIHtcbiAgICAgIHN3aXRjaCAod1htbC5hdHRyKCd3OmZsZENoYXJUeXBlJykpIHtcbiAgICAgICAgY2FzZSAnYmVnaW4nOlxuICAgICAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvZmllbGRCZWdpbicpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2VuZCc6XG4gICAgICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9maWVsZEVuZCcpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3NlcGFyYXRlJzpcbiAgICAgICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2ZpZWxkU2VwYXJhdGUnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoJ3RibCcgPT0gdGFnKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC90YWJsZScpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ3RyJyA9PSB0YWcpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL3JvdycpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ3RjJyA9PSB0YWcpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2NlbGwnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdicicgPT0gdGFnKSByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2JyJykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgnaHlwZXJsaW5rJyA9PSB0YWcgJiYgJ3AnID09IHdYbWwucGFyZW50Tm9kZS5sb2NhbE5hbWUpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2h5cGVybGluaycpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ0FsdGVybmF0ZUNvbnRlbnQnID09IHRhZylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvZHJhd2luZ0FuY2hvcicpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ3dzcCcgPT0gdGFnKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9zaGFwZScpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ2lubGluZScgPT0gdGFnKSB7XG4gICAgICB2YXIgdHlwZSA9IHdYbWwuJDEoJz5ncmFwaGljPmdyYXBoaWNEYXRhJykuYXR0cigndXJpJykuc3BsaXQoJy8nKS5wb3AoKTtcbiAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlICdwaWN0dXJlJzpcbiAgICAgICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2ltYWdlJykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICAgICAgY2FzZSAnZGlhZ3JhbSc6XG4gICAgICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9kaWFncmFtJykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICAgICAgY2FzZSAnY2hhcnQnOlxuICAgICAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvY2hhcnQnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2lubGluZSAnICsgdHlwZSArICcgaXMgbm90IHN1cHBvcmVkIHlldC4nKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCdzZHQnID09IHRhZykge1xuICAgICAgdmFyIGVsQmluZGluZyA9IHdYbWwuJDEoJz5zZHRQcj5kYXRhQmluZGluZycpO1xuICAgICAgaWYgKGVsQmluZGluZykge1xuICAgICAgICAvL3Byb3BlcnRpZXNcbiAgICAgICAgdmFyIHBhdGggPSBhdHRyKGVsQmluZGluZywgJ3c6eHBhdGgnKSxcbiAgICAgICAgICBkID0gcGF0aC5zcGxpdCgvW1xcL1xcOlxcW10vKSxcbiAgICAgICAgICBuYW1lID0gKGQucG9wKCksIGQucG9wKCkpO1xuICAgICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2RvY3VtZW50UHJvcGVydHknKSkoXG4gICAgICAgICAgd1htbCxcbiAgICAgICAgICBkb2MsXG4gICAgICAgICAgcGFyZW50LFxuICAgICAgICAgIG5hbWVcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vY29udHJvbHNcbiAgICAgICAgbGV0IGVsVHlwZSA9IHdYbWxcbiAgICAgICAgICAuJDEoJz5zZHRQcicpXG4gICAgICAgICAgLiQxKFxuICAgICAgICAgICAgJ3RleHQsIHBpY3R1cmUsIGRvY1BhcnRMaXN0LCBjb21ib0JveCwgZHJvcERvd25MaXN0LCBkYXRlLCBjaGVja2JveCdcbiAgICAgICAgICApO1xuICAgICAgICB0YWcgPSBlbFR5cGUgPyBlbFR5cGUubG9jYWxOYW1lIDogJ3JpY2h0ZXh0JztcblxuICAgICAgICBsZXQgY29udHJvbCA9IHRoaXMuY3JlYXRlQ29udHJvbCh0YWcsIC4uLmFyZ3VtZW50cyk7XG5cbiAgICAgICAgaWYgKGNvbnRyb2wpIHJldHVybiBjb250cm9sO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoJ2Jvb2ttYXJrU3RhcnQnID09IHRhZylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvYm9va21hcmtTdGFydCcpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ2Jvb2ttYXJrRW5kJyA9PSB0YWcpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2Jvb2ttYXJrRW5kJykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgnb01hdGgnID09IHRhZylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvZXF1YXRpb24nKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdvYmplY3QnID09IHRhZylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvT0xFJykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgnc2VjdFByJyA9PSB0YWcpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL3NlY3Rpb24nKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuXG4gICAgcmV0dXJuIG5ldyBNb2RlbCh3WG1sLCBkb2MsIHBhcmVudCk7XG4gIH1cblxuICBjcmVhdGVDb250cm9sKHR5cGUsIHdYbWwsIGRvYywgcGFyZW50KSB7XG4gICAgaWYgKCd0ZXh0JyA9PSB0eXBlKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9jb250cm9sL3RleHQnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdwaWN0dXJlJyA9PSB0eXBlKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9jb250cm9sL3BpY3R1cmUnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdkb2NQYXJ0TGlzdCcgPT0gdHlwZSlcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvY29udHJvbC9nYWxsZXJ5JykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgnY29tYm9Cb3gnID09IHR5cGUpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2NvbnRyb2wvY29tYm9ib3gnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdkcm9wRG93bkxpc3QnID09IHR5cGUpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2NvbnRyb2wvZHJvcGRvd24nKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdkYXRlJyA9PSB0eXBlKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9jb250cm9sL2RhdGUnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdjaGVja2JveCcgPT0gdHlwZSlcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvY29udHJvbC9jaGVja2JveCcpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ3JpY2h0ZXh0JyA9PSB0eXBlKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9jb250cm9sL3JpY2h0ZXh0JykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgfVxufVxuIl19
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _model = require('./model');

var _model2 = _interopRequireDefault(_model);

var _document = require('../document');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

function attr(node) {
  var name = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'w:val';

  return node ? node.attr(name) : undefined;
}

var Factory = function (_Base) {
  _inherits(Factory, _Base);

  function Factory() {
    _classCallCheck(this, Factory);

    return _possibleConstructorReturn(this, (Factory.__proto__ || Object.getPrototypeOf(Factory)).apply(this, arguments));
  }

  _createClass(Factory, [{
    key: 'create',
    value: function create(wXml, doc, parent, more) {
      var tag = wXml.localName,
          swap;

      if ('document' == tag) return new (require('./model/document'))(wXml, doc, parent);else if ('styles' == tag) return new (require('./model/documentStyles'))(wXml, doc);else if ('abstractNum' == tag) return new (require('./model/style/numberingDefinition'))(wXml, doc);else if ('num' == tag) return new (require('./model/style/list'))(wXml, doc);else if ('style' == tag) {
        switch (wXml.attr('w:type')) {
          case 'paragraph':
            return new (require('./model/style/paragraph'))(wXml, doc);
          case 'character':
            return new (require('./model/style/inline'))(wXml, doc);
          case 'table':
            return new (require('./model/style/table'))(wXml, doc);
          case 'numbering':
            return new (require('./model/style/numbering'))(wXml, doc);
        }
      } else if ('docDefaults' == tag) return new (require('./model/style/document'))(wXml, doc);else if ('body' == tag) return new (require('./model/body'))(wXml, doc, parent);else if ('p' == tag) {
        var styleId = attr(wXml.$1('>pPr>pStyle'), 'w:val'),
            style = doc.style.get(styleId);
        if (wXml.$1('>pPr>numPr') || style && style.getNumId() != -1) return new (require('./model/list'))(wXml, doc, parent);

        var outlineLvl = -1,
            tmp = void 0;
        if (style) outlineLvl = style.getOutlineLevel();else if (tmp = wXml.$1('>pPr>outlineLvl')) {
          tmp = parseInt(attr(tmp));
          outlineLvl = parseInt(tmp);
        }

        if (outlineLvl != -1) return new (require('./model/heading'))(wXml, doc, parent, outlineLvl);

        return new (require('./model/paragraph'))(wXml, doc, parent);
      } else if ('r' == tag) {
        var _style = doc.style.get(attr(wXml.$1('>rPr>rStyle'), 'w:val'));

        var _outlineLvl = -1,
            _tmp = void 0;
        if (_style) _outlineLvl = _style.getOutlineLevel();else if (_tmp = wXml.$1('>rPr>outlineLvl')) {
          _tmp = attr(_tmp);
          _outlineLvl = parseInt(_tmp);
        }

        if (_outlineLvl != -1) return new (require('./model/headingInline'))(wXml, doc, parent, _outlineLvl);

        if (wXml.childNodes.length == 1 || wXml.childNodes == 2 && wXml.firstChild.localName == 'rPr') {
          switch (wXml.lastChild.localName) {
            case 'fldChar':
              switch (wXml.lastChild.attr('w:fldCharType')) {
                case 'begin':
                  return new (require('./model/fieldBegin'))(wXml.lastChild, doc, parent);
                  break;
                case 'end':
                  return new (require('./model/fieldEnd'))(wXml.lastChild, doc, parent);
                  break;
                case 'separate':
                  return new (require('./model/fieldSeparate'))(wXml.lastChild, doc, parent);
                  break;
              }
            case 'instrText':
              return new (require('./model/fieldInstruct'))(wXml.lastChild, doc, parent);
          }
        }

        return new (require('./model/inline'))(wXml, doc, parent);
      } else if ('instrText' == tag) return new (require('./model/fieldInstruct'))(wXml, doc, parent);else if ('t' == tag) return new (require('./model/text'))(wXml, doc, parent);else if ('sym' == tag && wXml.parentNode.localName == 'r') return new (require('./model/symbol'))(wXml, doc, parent);else if ('softHyphen' == tag && wXml.parentNode.localName == 'r') return new (require('./model/softHyphen'))(wXml, doc, parent);else if ('noBreakHyphen' == tag && wXml.parentNode.localName == 'r') return new (require('./model/noBreakHyphen'))(wXml, doc, parent);else if ('tab' == tag && wXml.parentNode.localName == 'r') return new (require('./model/tab'))(wXml, doc, parent);else if ('fldSimple' == tag) return new (require('./model/fieldSimple'))(wXml, doc, parent);else if ('fldChar' == tag) {
        switch (wXml.attr('w:fldCharType')) {
          case 'begin':
            return new (require('./model/fieldBegin'))(wXml, doc, parent);
            break;
          case 'end':
            return new (require('./model/fieldEnd'))(wXml, doc, parent);
            break;
          case 'separate':
            return new (require('./model/fieldSeparate'))(wXml, doc, parent);
            break;
        }
      } else if ('tbl' == tag) return new (require('./model/table'))(wXml, doc, parent);else if ('tr' == tag) return new (require('./model/row'))(wXml, doc, parent);else if ('tc' == tag) return new (require('./model/cell'))(wXml, doc, parent);else if ('br' == tag) return new (require('./model/br'))(wXml, doc, parent);else if ('hyperlink' == tag && 'p' == wXml.parentNode.localName) return new (require('./model/hyperlink'))(wXml, doc, parent);else if ('AlternateContent' == tag) return new (require('./model/drawingAnchor'))(wXml, doc, parent);else if ('wsp' == tag) return new (require('./model/shape'))(wXml, doc, parent);else if ('inline' == tag) {
        var type = wXml.$1('>graphic>graphicData').attr('uri').split('/').pop();
        switch (type) {
          case 'picture':
            return new (require('./model/image'))(wXml, doc, parent);
          case 'diagram':
            return new (require('./model/diagram'))(wXml, doc, parent);
          case 'chart':
            return new (require('./model/chart'))(wXml, doc, parent);
          default:
            console.error('inline ' + type + ' is not suppored yet.');
        }
      } else if ('sdt' == tag) {
        var elBinding = wXml.$1('>sdtPr>dataBinding');
        if (elBinding) {
          //properties
          var path = attr(elBinding, 'w:xpath'),
              d = path.split(/[\/\:\[]/),
              name = (d.pop(), d.pop());
          return new (require('./model/documentProperty'))(wXml, doc, parent, name);
        } else {
          //controls
          var elType = wXml.$1('>sdtPr').$1('text, picture, docPartList, comboBox, dropDownList, date, checkbox');
          tag = elType ? elType.localName : 'richtext';

          var control = this.createControl.apply(this, [tag].concat(Array.prototype.slice.call(arguments)));

          if (control) return control;
        }
      } else if ('bookmarkStart' == tag) return new (require('./model/bookmarkStart'))(wXml, doc, parent);else if ('bookmarkEnd' == tag) return new (require('./model/bookmarkEnd'))(wXml, doc, parent);else if ('oMath' == tag) return new (require('./model/equation'))(wXml, doc, parent);else if ('object' == tag) return new (require('./model/OLE'))(wXml, doc, parent);else if ('sectPr' == tag) return new (require('./model/section'))(wXml, doc, parent);

      return new _model2.default(wXml, doc, parent);
    }
  }, {
    key: 'createControl',
    value: function createControl(type, wXml, doc, parent) {
      if ('text' == type) return new (require('./model/control/text'))(wXml, doc, parent);else if ('picture' == type) return new (require('./model/control/picture'))(wXml, doc, parent);else if ('docPartList' == type) return new (require('./model/control/gallery'))(wXml, doc, parent);else if ('comboBox' == type) return new (require('./model/control/combobox'))(wXml, doc, parent);else if ('dropDownList' == type) return new (require('./model/control/dropdown'))(wXml, doc, parent);else if ('date' == type) return new (require('./model/control/date'))(wXml, doc, parent);else if ('checkbox' == type) return new (require('./model/control/checkbox'))(wXml, doc, parent);else if ('richtext' == type) return new (require('./model/control/richtext'))(wXml, doc, parent);
    }
  }]);

  return Factory;
}(_document.Factory);

exports.default = Factory;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9vcGVueG1sL2RvY3gvZmFjdG9yeS5qcyJdLCJuYW1lcyI6WyJhdHRyIiwibm9kZSIsIm5hbWUiLCJ1bmRlZmluZWQiLCJGYWN0b3J5Iiwid1htbCIsImRvYyIsInBhcmVudCIsIm1vcmUiLCJ0YWciLCJsb2NhbE5hbWUiLCJzd2FwIiwicmVxdWlyZSIsInN0eWxlSWQiLCIkMSIsInN0eWxlIiwiZ2V0IiwiZ2V0TnVtSWQiLCJvdXRsaW5lTHZsIiwidG1wIiwiZ2V0T3V0bGluZUxldmVsIiwicGFyc2VJbnQiLCJjaGlsZE5vZGVzIiwibGVuZ3RoIiwiZmlyc3RDaGlsZCIsImxhc3RDaGlsZCIsInBhcmVudE5vZGUiLCJ0eXBlIiwic3BsaXQiLCJwb3AiLCJjb25zb2xlIiwiZXJyb3IiLCJlbEJpbmRpbmciLCJwYXRoIiwiZCIsImVsVHlwZSIsImNvbnRyb2wiLCJjcmVhdGVDb250cm9sIiwiYXJndW1lbnRzIiwiTW9kZWwiLCJCYXNlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7Ozs7Ozs7QUFFQSxTQUFTQSxJQUFULENBQWNDLElBQWQsRUFBb0M7QUFBQSxNQUFoQkMsSUFBZ0IsdUVBQVQsT0FBUzs7QUFDbEMsU0FBT0QsT0FBT0EsS0FBS0QsSUFBTCxDQUFVRSxJQUFWLENBQVAsR0FBeUJDLFNBQWhDO0FBQ0Q7O0lBRW9CQyxPOzs7Ozs7Ozs7OzsyQkFDWkMsSSxFQUFNQyxHLEVBQUtDLE0sRUFBUUMsSSxFQUFNO0FBQzlCLFVBQUlDLE1BQU1KLEtBQUtLLFNBQWY7QUFBQSxVQUNFQyxJQURGOztBQUdBLFVBQUksY0FBY0YsR0FBbEIsRUFDRSxPQUFPLEtBQUtHLFFBQVEsa0JBQVIsQ0FBTCxFQUFrQ1AsSUFBbEMsRUFBd0NDLEdBQXhDLEVBQTZDQyxNQUE3QyxDQUFQLENBREYsS0FFSyxJQUFJLFlBQVlFLEdBQWhCLEVBQ0gsT0FBTyxLQUFLRyxRQUFRLHdCQUFSLENBQUwsRUFBd0NQLElBQXhDLEVBQThD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QUNILE9BQU8sS0FBS2YsUUFBUSwwQkFBUixDQUFMLEVBQTBDUCxJQUExQyxFQUFnREMsR0FBaEQsRUFBcURDLE1BQXJELENBQVA7QUFDSDs7OztFQXBNa0NpQyxpQjs7a0JBQWhCcEMsTyIsImZpbGUiOiJmYWN0b3J5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE1vZGVsIGZyb20gJy4vbW9kZWwnO1xuaW1wb3J0IHsgRmFjdG9yeSBhcyBCYXNlIH0gZnJvbSAnLi4vZG9jdW1lbnQnO1xuXG5mdW5jdGlvbiBhdHRyKG5vZGUsIG5hbWUgPSAndzp2YWwnKSB7XG4gIHJldHVybiBub2RlID8gbm9kZS5hdHRyKG5hbWUpIDogdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGYWN0b3J5IGV4dGVuZHMgQmFzZSB7XG4gIGNyZWF0ZSh3WG1sLCBkb2MsIHBhcmVudCwgbW9yZSkge1xuICAgIHZhciB0YWcgPSB3WG1sLmxvY2FsTmFtZSxcbiAgICAgIHN3YXA7XG5cbiAgICBpZiAoJ2RvY3VtZW50JyA9PSB0YWcpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2RvY3VtZW50JykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgnc3R5bGVzJyA9PSB0YWcpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2RvY3VtZW50U3R5bGVzJykpKHdYbWwsIGRvYyk7XG4gICAgZWxzZSBpZiAoJ2Fic3RyYWN0TnVtJyA9PSB0YWcpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL3N0eWxlL251bWJlcmluZ0RlZmluaXRpb24nKSkod1htbCwgZG9jKTtcbiAgICBlbHNlIGlmICgnbnVtJyA9PSB0YWcpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL3N0eWxlL2xpc3QnKSkod1htbCwgZG9jKTtcbiAgICBlbHNlIGlmICgnc3R5bGUnID09IHRhZykge1xuICAgICAgc3dpdGNoICh3WG1sLmF0dHIoJ3c6dHlwZScpKSB7XG4gICAgICAgIGNhc2UgJ3BhcmFncmFwaCc6XG4gICAgICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9zdHlsZS9wYXJhZ3JhcGgnKSkod1htbCwgZG9jKTtcbiAgICAgICAgY2FzZSAnY2hhcmFjdGVyJzpcbiAgICAgICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL3N0eWxlL2lubGluZScpKSh3WG1sLCBkb2MpO1xuICAgICAgICBjYXNlICd0YWJsZSc6XG4gICAgICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9zdHlsZS90YWJsZScpKSh3WG1sLCBkb2MpO1xuICAgICAgICBjYXNlICdudW1iZXJpbmcnOlxuICAgICAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvc3R5bGUvbnVtYmVyaW5nJykpKHdYbWwsIGRvYyk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICgnZG9jRGVmYXVsdHMnID09IHRhZylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvc3R5bGUvZG9jdW1lbnQnKSkod1htbCwgZG9jKTtcbiAgICBlbHNlIGlmICgnYm9keScgPT0gdGFnKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9ib2R5JykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgncCcgPT0gdGFnKSB7XG4gICAgICB2YXIgc3R5bGVJZCA9IGF0dHIod1htbC4kMSgnPnBQcj5wU3R5bGUnKSwgJ3c6dmFsJyksXG4gICAgICAgIHN0eWxlID0gZG9jLnN0eWxlLmdldChzdHlsZUlkKTtcbiAgICAgIGlmICh3WG1sLiQxKCc+cFByPm51bVByJykgfHwgKHN0eWxlICYmIHN0eWxlLmdldE51bUlkKCkgIT0gLTEpKVxuICAgICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2xpc3QnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuXG4gICAgICBsZXQgb3V0bGluZUx2bCA9IC0xLFxuICAgICAgICB0bXA7XG4gICAgICBpZiAoc3R5bGUpIG91dGxpbmVMdmwgPSBzdHlsZS5nZXRPdXRsaW5lTGV2ZWwoKTtcbiAgICAgIGVsc2UgaWYgKCh0bXAgPSB3WG1sLiQxKCc+cFByPm91dGxpbmVMdmwnKSkpIHtcbiAgICAgICAgdG1wID0gcGFyc2VJbnQoYXR0cih0bXApKTtcbiAgICAgICAgb3V0bGluZUx2bCA9IHBhcnNlSW50KHRtcCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChvdXRsaW5lTHZsICE9IC0xKVxuICAgICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2hlYWRpbmcnKSkod1htbCwgZG9jLCBwYXJlbnQsIG91dGxpbmVMdmwpO1xuXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL3BhcmFncmFwaCcpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgfSBlbHNlIGlmICgncicgPT0gdGFnKSB7XG4gICAgICBsZXQgc3R5bGUgPSBkb2Muc3R5bGUuZ2V0KGF0dHIod1htbC4kMSgnPnJQcj5yU3R5bGUnKSwgJ3c6dmFsJykpO1xuXG4gICAgICBsZXQgb3V0bGluZUx2bCA9IC0xLFxuICAgICAgICB0bXA7XG4gICAgICBpZiAoc3R5bGUpIG91dGxpbmVMdmwgPSBzdHlsZS5nZXRPdXRsaW5lTGV2ZWwoKTtcbiAgICAgIGVsc2UgaWYgKCh0bXAgPSB3WG1sLiQxKCc+clByPm91dGxpbmVMdmwnKSkpIHtcbiAgICAgICAgdG1wID0gYXR0cih0bXApO1xuICAgICAgICBvdXRsaW5lTHZsID0gcGFyc2VJbnQodG1wKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG91dGxpbmVMdmwgIT0gLTEpXG4gICAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvaGVhZGluZ0lubGluZScpKShcbiAgICAgICAgICB3WG1sLFxuICAgICAgICAgIGRvYyxcbiAgICAgICAgICBwYXJlbnQsXG4gICAgICAgICAgb3V0bGluZUx2bFxuICAgICAgICApO1xuXG4gICAgICBpZiAoXG4gICAgICAgIHdYbWwuY2hpbGROb2Rlcy5sZW5ndGggPT0gMSB8fFxuICAgICAgICAod1htbC5jaGlsZE5vZGVzID09IDIgJiYgd1htbC5maXJzdENoaWxkLmxvY2FsTmFtZSA9PSAnclByJylcbiAgICAgICkge1xuICAgICAgICBzd2l0Y2ggKHdYbWwubGFzdENoaWxkLmxvY2FsTmFtZSkge1xuICAgICAgICAgIGNhc2UgJ2ZsZENoYXInOlxuICAgICAgICAgICAgc3dpdGNoICh3WG1sLmxhc3RDaGlsZC5hdHRyKCd3OmZsZENoYXJUeXBlJykpIHtcbiAgICAgICAgICAgICAgY2FzZSAnYmVnaW4nOlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvZmllbGRCZWdpbicpKSh3WG1sLmxhc3RDaGlsZCwgZG9jLCBwYXJlbnQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICdlbmQnOlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvZmllbGRFbmQnKSkod1htbC5sYXN0Q2hpbGQsIGRvYywgcGFyZW50KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnc2VwYXJhdGUnOlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvZmllbGRTZXBhcmF0ZScpKSh3WG1sLmxhc3RDaGlsZCwgZG9jLCBwYXJlbnQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgJ2luc3RyVGV4dCc6XG4gICAgICAgICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2ZpZWxkSW5zdHJ1Y3QnKSkod1htbC5sYXN0Q2hpbGQsIGRvYywgcGFyZW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2lubGluZScpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgfSBlbHNlIGlmICgnaW5zdHJUZXh0JyA9PSB0YWcpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2ZpZWxkSW5zdHJ1Y3QnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCd0JyA9PSB0YWcpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL3RleHQnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdzeW0nID09IHRhZyAmJiB3WG1sLnBhcmVudE5vZGUubG9jYWxOYW1lID09ICdyJylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvc3ltYm9sJykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgnc29mdEh5cGhlbicgPT0gdGFnICYmIHdYbWwucGFyZW50Tm9kZS5sb2NhbE5hbWUgPT0gJ3InKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9zb2Z0SHlwaGVuJykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgnbm9CcmVha0h5cGhlbicgPT0gdGFnICYmIHdYbWwucGFyZW50Tm9kZS5sb2NhbE5hbWUgPT0gJ3InKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9ub0JyZWFrSHlwaGVuJykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgndGFiJyA9PSB0YWcgJiYgd1htbC5wYXJlbnROb2RlLmxvY2FsTmFtZSA9PSAncicpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL3RhYicpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ2ZsZFNpbXBsZScgPT0gdGFnKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9maWVsZFNpbXBsZScpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ2ZsZENoYXInID09IHRhZykge1xuICAgICAgc3dpdGNoICh3WG1sLmF0dHIoJ3c6ZmxkQ2hhclR5cGUnKSkge1xuICAgICAgICBjYXNlICdiZWdpbic6XG4gICAgICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9maWVsZEJlZ2luJykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnZW5kJzpcbiAgICAgICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2ZpZWxkRW5kJykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnc2VwYXJhdGUnOlxuICAgICAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvZmllbGRTZXBhcmF0ZScpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICgndGJsJyA9PSB0YWcpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL3RhYmxlJykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgndHInID09IHRhZylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvcm93JykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgndGMnID09IHRhZylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvY2VsbCcpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ2JyJyA9PSB0YWcpIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvYnInKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdoeXBlcmxpbmsnID09IHRhZyAmJiAncCcgPT0gd1htbC5wYXJlbnROb2RlLmxvY2FsTmFtZSlcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvaHlwZXJsaW5rJykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgnQWx0ZXJuYXRlQ29udGVudCcgPT0gdGFnKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9kcmF3aW5nQW5jaG9yJykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgnd3NwJyA9PSB0YWcpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL3NoYXBlJykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgnaW5saW5lJyA9PSB0YWcpIHtcbiAgICAgIHZhciB0eXBlID0gd1htbC4kMSgnPmdyYXBoaWM+Z3JhcGhpY0RhdGEnKS5hdHRyKCd1cmknKS5zcGxpdCgnLycpLnBvcCgpO1xuICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgIGNhc2UgJ3BpY3R1cmUnOlxuICAgICAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvaW1hZ2UnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgICAgICBjYXNlICdkaWFncmFtJzpcbiAgICAgICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2RpYWdyYW0nKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgICAgICBjYXNlICdjaGFydCc6XG4gICAgICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9jaGFydCcpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgY29uc29sZS5lcnJvcignaW5saW5lICcgKyB0eXBlICsgJyBpcyBub3Qgc3VwcG9yZWQgeWV0LicpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoJ3NkdCcgPT0gdGFnKSB7XG4gICAgICB2YXIgZWxCaW5kaW5nID0gd1htbC4kMSgnPnNkdFByPmRhdGFCaW5kaW5nJyk7XG4gICAgICBpZiAoZWxCaW5kaW5nKSB7XG4gICAgICAgIC8vcHJvcGVydGllc1xuICAgICAgICB2YXIgcGF0aCA9IGF0dHIoZWxCaW5kaW5nLCAndzp4cGF0aCcpLFxuICAgICAgICAgIGQgPSBwYXRoLnNwbGl0KC9bXFwvXFw6XFxbXS8pLFxuICAgICAgICAgIG5hbWUgPSAoZC5wb3AoKSwgZC5wb3AoKSk7XG4gICAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvZG9jdW1lbnRQcm9wZXJ0eScpKShcbiAgICAgICAgICB3WG1sLFxuICAgICAgICAgIGRvYyxcbiAgICAgICAgICBwYXJlbnQsXG4gICAgICAgICAgbmFtZVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy9jb250cm9sc1xuICAgICAgICBsZXQgZWxUeXBlID0gd1htbFxuICAgICAgICAgIC4kMSgnPnNkdFByJylcbiAgICAgICAgICAuJDEoXG4gICAgICAgICAgICAndGV4dCwgcGljdHVyZSwgZG9jUGFydExpc3QsIGNvbWJvQm94LCBkcm9wRG93bkxpc3QsIGRhdGUsIGNoZWNrYm94J1xuICAgICAgICAgICk7XG4gICAgICAgIHRhZyA9IGVsVHlwZSA/IGVsVHlwZS5sb2NhbE5hbWUgOiAncmljaHRleHQnO1xuXG4gICAgICAgIGxldCBjb250cm9sID0gdGhpcy5jcmVhdGVDb250cm9sKHRhZywgLi4uYXJndW1lbnRzKTtcblxuICAgICAgICBpZiAoY29udHJvbCkgcmV0dXJuIGNvbnRyb2w7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICgnYm9va21hcmtTdGFydCcgPT0gdGFnKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9ib29rbWFya1N0YXJ0JykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgnYm9va21hcmtFbmQnID09IHRhZylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvYm9va21hcmtFbmQnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdvTWF0aCcgPT0gdGFnKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9lcXVhdGlvbicpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ29iamVjdCcgPT0gdGFnKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9PTEUnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdzZWN0UHInID09IHRhZylcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvc2VjdGlvbicpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG5cbiAgICByZXR1cm4gbmV3IE1vZGVsKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgfVxuXG4gIGNyZWF0ZUNvbnRyb2wodHlwZSwgd1htbCwgZG9jLCBwYXJlbnQpIHtcbiAgICBpZiAoJ3RleHQnID09IHR5cGUpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2NvbnRyb2wvdGV4dCcpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ3BpY3R1cmUnID09IHR5cGUpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2NvbnRyb2wvcGljdHVyZScpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ2RvY1BhcnRMaXN0JyA9PSB0eXBlKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9jb250cm9sL2dhbGxlcnknKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICAgIGVsc2UgaWYgKCdjb21ib0JveCcgPT0gdHlwZSlcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvY29udHJvbC9jb21ib2JveCcpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ2Ryb3BEb3duTGlzdCcgPT0gdHlwZSlcbiAgICAgIHJldHVybiBuZXcgKHJlcXVpcmUoJy4vbW9kZWwvY29udHJvbC9kcm9wZG93bicpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ2RhdGUnID09IHR5cGUpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2NvbnRyb2wvZGF0ZScpKSh3WG1sLCBkb2MsIHBhcmVudCk7XG4gICAgZWxzZSBpZiAoJ2NoZWNrYm94JyA9PSB0eXBlKVxuICAgICAgcmV0dXJuIG5ldyAocmVxdWlyZSgnLi9tb2RlbC9jb250cm9sL2NoZWNrYm94JykpKHdYbWwsIGRvYywgcGFyZW50KTtcbiAgICBlbHNlIGlmICgncmljaHRleHQnID09IHR5cGUpXG4gICAgICByZXR1cm4gbmV3IChyZXF1aXJlKCcuL21vZGVsL2NvbnRyb2wvcmljaHRleHQnKSkod1htbCwgZG9jLCBwYXJlbnQpO1xuICB9XG59XG4iXX0=